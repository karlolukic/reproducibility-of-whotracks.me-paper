---
title: "WhoTracks.me - Study Replication"
author: 'Karlo Lukic, lukic@wiwi.uni-frankfurt.de'
date: "2020-08-03"
output:
  html_document: 
    code_folding: hide
    number_sections: yes
    toc: yes
    toc_depth: 4
    toc_float: yes
editor_options: 
  chunk_output_type: console
---


<style>
body {
text-align: justify}
</style>

```{r, include=T}
# libs
library(magrittr)
library(data.table)
library(ggplot2)
```

# Info

This analysis reproduces [WhoTracks.me paper](https://t.ly/rKI5)'s "Results"
section. The analysis is done in the manner of stating a question that can be
answered with the data. Links to citations from the paper that confirm
replicated results are also included.

***
# Data

```{r, include=T}
# load data
global_sites_DT <- readRDS('./data/global/sites_DT.rds')
global_trackers_DT <- readRDS('./data/global/trackers_DT.rds')
global_companies_DT <- readRDS('./data/global/companies_DT.rds')
```

> "In this paper we present the WhoTracks.Me dataset, which contains aggregated
data on third-party presence and tracking, released monthly. The data is
generated by Ghostery and Cliqz users who have consented to anonymized HumanWeb
data collection. This generates data on an average of 100 million page loads per
month, increasing to over 300 million since April 2018, and currently spans 12
months."


***
# Snapshot in Time

> "We will be looking at the data from April 2018, composed of roughly 340 million page loads, and filtering the top 1330 most visited websites."


## Tracking stats (April 2018)

Subset time:

```{r}
# subset April 2018
global_sites_DT_apr_18 <- global_sites_DT[month=='2018-04-30']
unique(global_sites_DT_apr_18$month)
```

What's the total number of unique sites in this dataset?

```{r}
# filter top 1330 most visited sites
uniqueN(global_sites_DT_apr_18, by='site')
```

What percentage of traffic to these sites contains tracking (by cookies & fingerprinting combined)?

```{r}
# 71% of traffic to these sites contains tracking
mean(global_sites_DT_apr_18$tracked)*100
```

What's the avg. number of trackers per site?

```{r}
# average number of trackers per site is 8 (actually 9)
mean(global_sites_DT_apr_18$trackers)
```

What's the avg. number of tracking requests per page load?

```{r}
# average number of tracking requests per page load is 17 (actually 18)
mean(global_sites_DT_apr_18$requests_tracking)
```

> "We measure that 71% of the traffic to these sites contains tracking. The average number of trackers per site is 8, and the average number of tracking requests per page load 17."


## Tracking by website categories

What's the avg. number of trackers per website category in April 2018? 
What's the avg. percentage of page loads where users are being tracked, per website category in April 2018?

```{r}
# subset: 
# 1. avg. # of trackers
# 2. % of page loads tracked
# per site category
DT <- global_sites_DT_apr_18[, .(category, trackers, tracked)] # take 3 cols
DT <- DT[, lapply(.SD, mean), by = category][order(trackers, decreasing = T)] # take averages
DT[, tracked := tracked * 100] # to %
DT
```

```{r, include=F}
# prepare DT for visualization
DT <- melt(DT, id.vars = 'category', 
     measure.vars = c('trackers', 'tracked'),
     variable.name = 'variable')
DT[variable == 'tracked', value := value / 10] # transform tracked % to be roughly equal to trackers
DT
```

Visualize avg. number of trackers & avg. % of being tracked per website category in April 2018.

<center>
```{r}
# visualize
ggplot(DT, aes(x=reorder(category, -value), y=value, fill=variable)) +
  geom_bar(stat='identity', position='dodge') +
  hrbrthemes::scale_fill_ft() +
  scale_y_continuous(name= 'avg. # of trackers', 
                     sec.axis = sec_axis(~ . * 10, name = '% of page loads tracked')) +
  labs(title = "Tracking by website categories", subtitle = 'April 2018', x = "website category") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5), # center the title
        plot.subtitle = element_text(hjust = 0.5), # center the sub-title
        axis.text.x = element_text(angle = 45, hjust = 0.8), # add colors to text/axis
        axis.title.y.left = element_text(color="#627A88"),
        axis.title.y.right = element_text(color="#0954C2", angle = 90))
```
</center>


> "...websites in the category of News and Portals have the highest number of third parties at approximately 13 per page on average, with tracking occurring on 79 % of the measured page loads. Banking websites tend to have the lowest number of third parties as well as a lower percentage of page loads where tracking occurs."



## Top 10 trackers by reach and tracking


```{r}
# subset April 2018
global_trackers_DT_apr_18 <- global_trackers_DT[month=='2018-04-30']
```

What are top 10 trackers by reach?

```{r}
# subset top 10 trackers by reach
DT <- global_trackers_DT_apr_18[reach > 0.098] # approx. reach to get 10
DT <- DT[, .(tracker_name, reach, tracked)][order(reach, decreasing = T)] # take 3 cols
DT
```

Add `tracking_context` variable:

$$tracking\ context = reach \times tracked$$

```{r}
# add var: tracking_context
DT[, tracking_context := tracked * reach]
head(DT)
```

```{r, include=F}
# prepare DT for visualization
DT <- melt(DT, id.vars = 'tracker_name', 
     measure.vars = c('reach', 'tracking_context'),
     variable.name = 'variable')
DT[, value := value * 100] # get %, transform for plot
DT

# reorder factors for plot
tracker_name_ordered <- head(unique(DT$tracker_name), 10)
DT$tracker_name <- factor(DT$tracker_name, levels = tracker_name_ordered)
```

Visualize the top 10 trackers by reach (presence) and their loads in tracking/non-tracking contexts.

<center>
```{r}
# visualize
ggplot(DT) +
 aes(x = reorder(tracker_name, dplyr::desc(tracker_name)), fill = variable, weight = value) +
 geom_bar(position = "dodge") +
 hrbrthemes::scale_fill_ft(labels = c("Non-tracking context (reach)", "Tracking context")) +
 coord_flip() +
 theme_minimal() +
 labs(title = "Top 10 third parties by reach", 
      subtitle = 'April 2018', 
      x = NULL, 
      y = '% of page loads',
      fill = NULL) +
  theme(legend.position = c(0.6,0.2),
        plot.title = element_text(hjust = 0.5), # center the title
        plot.subtitle = element_text(hjust = 0.5)) # center the sub-title
```
</center>

> "...Google Analytics has the highest reach, being present on roughly 46% of the measured web traffic, and 8 out of the top 10 third parties are operated by Google. ...Google APIs is mostly used to load other 3rd parties such as Google Fonts and other static scripts, which is why we see it largely operating in a non-tracking context."


## Top 10 companies by reach and tracking

What are the top 10 companies by reach and tracking?

```{r}
# subset April 2018
global_companies_DT_apr_18 <- global_companies_DT[month=='2018-04-30']

# subset top 10 trackers by reach
DT <- global_companies_DT_apr_18[reach > 0.055] # approx. reach to get 10
DT <- DT[, .(month, company_name, reach, tracked)][order(reach, decreasing = T)] # take 3 cols
head(DT)
```

Add `tracking_context` again.

```{r}
# add var: tracking_context
DT[, tracking_context := tracked * reach][]
```
```{r, include=F}
# prepare DT for visualization
DT <- melt(DT, id.vars = 'company_name', 
     measure.vars = c('reach', 'tracking_context'),
     variable.name = 'variable')
DT[, value := value * 100] # get %
DT

# reorder factors for plot
company_name_ordered <- head(unique(DT$company_name), 10)
DT$company_name <- factor(DT$company_name, levels = company_name_ordered)
```

Visualize the top 10 tracking companies by reach (presence) and their loads in tracking/non-tracking contexts.

<center>
```{r}
# visualize
ggplot(DT) +
 aes(x = reorder(company_name, dplyr::desc(company_name)), fill = variable, weight = value) +
 geom_bar(position = "dodge") +
 hrbrthemes::scale_fill_ft(labels = c("Non-tracking context (reach)", "Tracking context")) +
 coord_flip() +
 theme_minimal() +
 labs(title = "Top 10 companies by reach", 
      subtitle = 'April 2018', 
      x = NULL, 
      y = '% of page loads',
      fill = NULL) +
  theme(legend.position = c(0.6,0.2),
        plot.title = element_text(hjust = 0.5), # center the title
        plot.subtitle = element_text(hjust = 0.5)) # center the sub-title
```
</center>

> "...third-party scripts owned by Google are present in about 82% of the measured web traffic, and operate in a tracking context for slightly less than half that time. Facebook and Amazon follow next, and generally the distribution of reach by organisation...has a long tail."



## 3p counts and block rates by category

What effect do ad-blockers have on trackers? What tracker categories are most impacted by ad-blockers?

```{r}
# subset April 2018
# filter out "Unknown" tracker categories
global_trackers_DT_apr_18 <- global_trackers_DT[month=='2018-04-30' & tracker_category != 'Unknown']

# subset 4 vars: tracker_name, tracker_category, reach, has_blocking
DT <- global_trackers_DT_apr_18[, .(tracker_name, tracker_category, reach, has_blocking)]

# group metrics: n_trackers, avg. amount of page loads blocked
DT <- DT[, .(n_trackers = uniqueN(tracker_name),  # get summary stats
       avg_pct_page_loads_blocked = mean(has_blocking*100)), by='tracker_category']
DT <- DT[order(avg_pct_page_loads_blocked, decreasing = T)] # order by blocking

# round %
DT[, avg_pct_page_loads_blocked := as.integer(avg_pct_page_loads_blocked*10)]

# print
head(DT)
```

```{r, include=F}
# prepare DT for visualization
DT <- melt(DT, id.vars = 'tracker_category', 
     measure.vars = c('n_trackers', 'avg_pct_page_loads_blocked'),
     variable.name = 'variable')
DT

# reorder factors for plot
tracer_categories_ordered <- head(unique(DT$tracker_category), 13)
DT$tracker_category <- factor(DT$tracker_category, levels = tracer_categories_ordered)
```

Visualize third-parties and their average block rates by category.

<center>
```{r}
# visualize
ggplot(DT) +
  aes(x = tracker_category, fill = variable, weight = value) +
  geom_bar(position = "dodge") +
  hrbrthemes::scale_fill_ft() +
  scale_y_continuous(
    name = "# of trackers",
    sec.axis = sec_axis(~ . / 10, name = "avg. % page loads blocked")
  ) +
  labs(title = "Third-party counts and avg. block-rates by category", subtitle = "April 2018", x = NULL, fill = NULL) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5), # center the title
    plot.subtitle = element_text(hjust = 0.5), # center the sub-title
    axis.text.x = element_text(angle = 45, hjust = 0.8), # add colors to text/axis
    axis.title.y.left = element_text(color = "#627A88"),
    axis.title.y.right = element_text(color = "#0954C2", angle = 90)
  )
```
</center>

> "Note how among third parties with the highest reach ..., those that provide advertising services are predominant (left y-axis in blue), representing almost half of the trackers analysed in this study. In the same figure, we see the proportion of page loads containing a tracker of a given category was blocked by an ad-blocker."


## Malacius trackers

What trackers are possible malacius trackers that could perform man-in-the-middle attacks?

```{r}
# find MITM trackers
# subset April 2018
# filter out "Unknown" tracker categories
global_trackers_DT_apr_18 <- global_trackers_DT[month=='2018-04-30' & tracker_category != 'Unknown']
```

Add variable `reach_to_site_reach` (tracker's presence redefined):

$$reach\ to\ site\ reach\ ratio= \frac{reach}{site\ reach}$$

```{r}
# add var: reach_to_site_reach
global_trackers_DT_apr_18[, reach_to_site_reach := round(reach / site_reach, digits = 2)]
global_trackers_DT_apr_18[, .(month, tracker_name, reach, site_reach, reach_to_site_reach)]
```

Table of popular trackers, present only on a few sites.

```{r}
# find very popular trackers, present only on a few sites
DT <- global_trackers_DT_apr_18[reach_to_site_reach >= 20]
DT <- DT[, .(tracker_name, tracker_category, company, reach_to_site_reach)]
gt::gt(DT) %>% 
  gt::tab_header(title='Highly popular trackers, present on minority of sites',
             subtitle = 'April 2018')
```

Table of unpopular trackers, present on large variety of sites.

```{r}
# find unpopular trackers, present on a large number of sites (proxy for malacious software)
DT <- global_trackers_DT_apr_18[reach_to_site_reach <= 0.10]
DT <- DT[, .(tracker_name, tracker_category, company, reach_to_site_reach)]
gt::gt(DT) %>% 
  gt::tab_header(title='Unpopular trackers, present on large number of sites (possibly malacious extensions)',
             subtitle = 'April 2018')

# filter to find "worlnaturenet.xyz" % eluxer.net
# you're being tracked more than 70% of the time, low avg. N of HTTP requests, higher reach, low RTST ratio
# DT[tracked >= .7][reach>=.001][requests <= 5][reach_to_site_reach <= 0.1]
```

> "Take the example of DoublePimp with a a reach to site reach ratio of 28.8 ..., typically present on adult sites, and particularly in a few popular ones. Similarly, `eluxer.net`, with a reach to site reach ratio of 0.1, is a malicious extension which does insert tracking."


***
# Longitudinal


## HTTPS Adoption


What was the avg. third-party HTTPS adoption of most visited sites in May 2017 vs. April 2018?

```{r}
# prepare data
# sites
# subset May 2017 & April 2018, take 3 vars
global_sites_DT_may_17 <- global_sites_DT[month=='2017-05-31', .(month, site, category, popularity, https)]
global_sites_DT_apr_18 <- global_sites_DT[month=='2018-04-30', .(month, site, category, popularity, https)]
```
```{r}
# compare avg. 3p HTTPS adoption on all top sites: May 2017
https_adopt_top_sites_may_17 <- 
  global_sites_DT_may_17[, .(avg_https_adoption_top_sites = mean(https))]
https_adopt_top_sites_may_17

# compare avg. 3p HTTPS adoption on all top sites: April 2018
https_adopt_top_sites_apr_18 <- 
global_sites_DT_apr_18[, .(avg_https_adoption_top_sites = mean(https))]
https_adopt_top_sites_apr_18
```

What was the avg. third-party HTTPS adoption of news sites in May 2017 vs. April 2018?

```{r}
# compare avg. 3p HTTPS adoption on news sites: May 17
https_adopt_news_sites_may_17 <- 
  global_sites_DT_may_17[, .(avg_https_adoption_news_sites = mean(https)), by='category'][category=='News and Portals'][, -c('category')]
https_adopt_news_sites_may_17

# compare avg. 3p HTTPS adoption on news sites: April 18
https_adopt_news_sites_apr_18 <- 
global_sites_DT_apr_18[, .(avg_https_adoption_news_sites = mean(https)), by='category'][category=='News and Portals'][, -c('category')]
https_adopt_news_sites_apr_18
```

What was the avg. third-party HTTPS adoption of top trackers (Google, Facebook, AppNexus) and an outlier (Snowplow) in May 2017 vs. April 2018?

```{r}
# prepare data & functions
# trackers
# get May 2017 & April 2018 info, 
# filter out "Unknown" tracker categories, take 3 vars: get_tracker_https_adoption
get_tracker_https_adoption_17 <- function(given_tracker_name) {
  global_trackers_DT[month=='2017-05-31' & tracker_category != 'Unknown', .(month, tracker_name, https)][tracker_name == (given_tracker_name), https]
}
get_tracker_https_adoption_18 <- function(given_tracker_name) {
  global_trackers_DT[month=='2018-04-30' & tracker_category != 'Unknown', .(month, tracker_name, https)][tracker_name == (given_tracker_name), https]
}

# compare avg. HTTPS adoption of 4 different trackers (operated by 4 diff. companies):
# 1. Google Analytics
# 2. Facebook
# 3. AppNexus
# 4. Snowplot (example for HTTPS adoption lag)
# get_tracker_https_adoption_17('Google Analytics')
# get_tracker_https_adoption_18('Google Analytics')
# get_tracker_https_adoption_17('Facebook')
# get_tracker_https_adoption_18('Facebook')
# get_tracker_https_adoption_17('AppNexus')
# get_tracker_https_adoption_18('AppNexus')
# get_tracker_https_adoption_17('Snowplow')
# get_tracker_https_adoption_18('Snowplow')
```

Pack metrics to a single table.

```{r}
# pack to DT
https_adopt_DT <- data.table(
  "Entity" = c(
    "Top sites", "News Sites",
    "Google Analytics", "Facebook", "AppNexus", "Snowplow"
  ),
  "May 2017" = as.numeric(c(
    https_adopt_top_sites_may_17, https_adopt_news_sites_may_17,
    get_tracker_https_adoption_17("Google Analytics"),
    get_tracker_https_adoption_17("Facebook"),
    get_tracker_https_adoption_17("AppNexus"),
    get_tracker_https_adoption_17("Snowplow"))
  ),
  "April 2018" = as.numeric(c(
    https_adopt_top_sites_apr_18, https_adopt_news_sites_apr_18,
    get_tracker_https_adoption_18("Google Analytics"),
    get_tracker_https_adoption_18("Facebook"),
    get_tracker_https_adoption_18("AppNexus"),
    get_tracker_https_adoption_18("Snowplow"))
  )
)

# add var: Change
https_adopt_DT[, Change := `April 2018` - `May 2017`]

# to table
gt::gt(https_adopt_DT) %>%
  gt::tab_header(
    title = "HTTPS Adoption of sites and trackers from May 2017 to April 2018",
  ) %>%
  gt::fmt_percent(
    columns = c("May 2017", "April 2018", "Change"),
    decimals = 1
  ) %>% 
  gt::tab_spanner(
  label = "All 3rd party secure requests",
  columns = c("May 2017", "April 2018", "Change"))
```

> "We can see a strong increase in sites which have all third-party content loaded over HTTPS, from 57% to 81%. Certain categories of site lag behind in this regard though, namely news sites. Looking at specific trackers, we can see dominant players such as Google Analytics and AppNexus successfully migrating clients to HTTPS over the year. Others, like Facebook, have had slower progress on this front. In general, trackers improved their HTTPS usage over this period, with only 65 trackers (of 587 with data at both time points) not increasing HTTPS coverage. A small number of outliers showed a negative trend, for example Snowplow, an analytics provider present on major news websites, including Le Monde and New York Times."


## Cost imposed on users

How "taxing" are trackers? In other words, what impact trackers have on user experience while they browse web pages? How much do they slow down the loading of websites?

```{r}
# subset April 2018 & May 2017
global_sites_DT_apr_18 <- global_sites_DT[month=='2018-04-30']
global_sites_DT_may_17 <- global_sites_DT[month == '2017-05-31']
```
What was the avg. number of third-party tracking requests per page load in April 2018 vs. May 2017?

April 2018: 

```{r}
# average number of tracking requests per page load is 17 (actually 18) in Apr 18
round(mean(global_sites_DT_apr_18$requests_tracking), 2)
```

May 2017: 

```{r}
# average number of tracking requests per page load is 35 in May 17
round(mean(global_sites_DT_may_17$requests_tracking), 2)
```

Measure the amount of data needed to load third-party content, i.e. the ["Tracker Tax"](https://t.ly/ofU0): 

> "We take the sum of the Content-Length of all third-party requests in the top 1330 websites over the last year, and measure the variation in this data consumption over time."

April 2018: 

```{r}
# get content_length stats: measure given in Bytes ( / 1000000 to Megabytes)
global_sites_DT_apr_18[, .(content_length), by=site][, summary(content_length / 1000000)]
```
May 2017: 

```{r}
global_sites_DT_may_17[, .(content_length), by=site][, summary(content_length / 1000000)]
```

> "The median content length per site from third parties was 0.42MB with an interquartile range (IQR) of 0.18-1.5MB [in April 2018], down from 0.58MB (IQR 0.24-1.8MB) a year earlier. The distribution has a long tail due to third parties offering Audio Video player services being part of the data."


## Tracking technologies over time

How Google Analytics operated its tracking in April 2018? How was the tracking done?

```{r}
# find Google Analytics info
global_trackers_DT_apr_18[tracker=='google_analytics', .(tracker_name, script, image, beacon)]
```

> "... we can see that, for example, during April 2018 Google Analytics loaded their [Java]script on each page load (97% of the time), then registered the visit via an image (pixel) on 50% of page loads. We also see that on 2.6% of pages a request is also made via the Beacon API."

What are the most popular ways to track online users? How did these technologies change over time from the tracker's perspective?

```{r, include=F}
# subset May 2017 - April 2018 period
global_trackers_DT_may_17_to_apr_18 <- global_trackers_DT[month >= '2017-05-31' & month <= '2018-04-30']
global_trackers_DT_may_17_to_apr_18[, uniqueN(month)]

# subset vars: content_media
content_types <- c('script', 'iframe', 'beacon', 'image', 'stylesheet', 'font', 'xhr', 'plugin', 'media')
DT <- global_trackers_DT_may_17_to_apr_18[, c('month', ..content_types)]
DT

# prepare data for viz
DT <- melt(DT, 
     id.vars = 'month', 
     measure.vars = content_types,
     variable.name = 'content_type',
     value.name = 'value')

# averages by year and media type
DT <- DT[, .(avg_value = mean(value)), by=.(content_type, month)]
DT[, avg_value := avg_value * 100] # to %
DT[, avg_value := avg_value / 2.5] # scale down
DT
```

Visualize the usage of tracking technologies over time by third-parties.

<center>
```{r}
# set order: script, image, iframe, beacon, stylesheet, font, xhr, plugin, media
factor_levels <- c('script', 'image', 'iframe', 'beacon', 'stylesheet', 'font', 'xhr', 'plugin', 'media')
DT$content_type <- factor(DT$content_type, 
                          levels = rev(factor_levels))

# visualize
ggplot(DT) +
 aes(x = month, y = avg_value, fill = content_type) +
 geom_area(size = 1L) +
 scale_fill_hue() +
 labs(title= 'Content type usage of third parties', subtitle = '12-month period', 
      x = "May 2017 - Apr. 2018", y = "% Percentage (stacked means)") +
 theme_minimal() +
 theme(plot.title = element_text(hjust = 0.5), 
       plot.subtitle = element_text(hjust = 0.5), 
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank(),
       legend.title = element_blank())
```
</center>

> "... scripts and images are the most popular content types for tracking. Interestingly, beacons, originally designed to satisfy tracking use cases are encountered increasingly less."



## Change in avg. reach over time by type of third party


How did third-party reach change over time? Which tracker categories changed their reach the most?

```{r, include=F}
# reload the tracker dataset, subset vars: month, tracker, tracker_name, tracker_category, reach
subset_vars <- c('month', 'tracker', 'tracker_name', 'tracker_category', 'reach')
DT <- global_trackers_DT_may_17_to_apr_18[, ..subset_vars]
DT

# change in avg.reach by tracker_category & month
DT <- DT[, .(avg_reach = mean(reach)), by=.(tracker_category, month)]
DT[, avg_reach:=avg_reach * 100] # to %
DT
```

Visualize change in avg. reach by tracker categories over time.

<center>
```{r}
# set fill order: script, image, iframe, beacon, stylesheet, font, xhr, plugin, media
factor_levels <- c('Unknown', 'Social media', 'Site analytics', 'Misc', 'Hosting', 'Extensions', 'Essential', 'Customer interaction', 'Comments', 'CDN', 'Audio video player', 'Advertising', 'Adult advertising')
DT$tracker_category <- factor(DT$tracker_category, 
                          levels = factor_levels)

# visualize
ggplot(DT) +
 aes(x = month, y = avg_reach, fill = tracker_category) +
 geom_area(size = 1L) +
 scale_fill_hue() +
 labs(x = "May. 2017 - Apr. 2018", y = "Avg. reach (stacked %)", title = "Change of reach by type of third party", subtitle = "12-month period") +
 theme_minimal()+
 theme(plot.title = element_text(hjust = 0.5), 
       plot.subtitle = element_text(hjust = 0.5), 
       axis.text.x=element_blank(),
       axis.ticks.x=element_blank(),
       legend.title = element_blank())
```
</center>

> "If grouped and averaged ... we observe almost an across-the-board decrease in the reach of third parties, most notably in the category of extensions that engage in MITM tracking. One explanation could be attributed to an increased adoption of ad-blockers. This analyses can be conducted at a more fine granular level, by monitoring the change in the average number of third parties in any given site."



## Change in avg. number of third parties over time on The Guardian and Le Figaro

Focus on more granural differences: visualize the change of avg. number of third-party trackers over time on two chosen sites -- The Guardian and Le Figaro.

```{r, include=F}
# subset 12-month period
global_sites_DT_may_17_to_apr_18 <- global_sites_DT[month>='2017-05-31' & month <='2018-04-30']

# subset The Guardian & Le Figaro
guardian_DT <- global_sites_DT_may_17_to_apr_18[site %like% 'guardian']
lefigaro_DT <- global_sites_DT_may_17_to_apr_18[site %like% 'lefigaro']

# bind above
DT <- rbind(guardian_DT, lefigaro_DT)
DT <- DT[, .(month, variable = site, avg_n_trackers = trackers)]
DT

# add industry benchmark: avg. # of trackers in 'news and portals' category
news_and_portals_avg_DT <- global_sites_DT_may_17_to_apr_18[category=='News and Portals', .(avg_n_trackers = mean(trackers)), by=.(month, variable = category)]
news_and_portals_avg_DT

# bind all
DT <- rbind(DT, news_and_portals_avg_DT)
DT

# rename value
DT[variable %like% 'News', variable := stringr::str_replace(variable, 'News and Portals', 'News and Portals Average')]
```

<center>
```{r}
# visualize
ggplot(DT) +
 aes(x = month, y = avg_n_trackers, color = variable) +
 geom_line(size = 0.78) +
 scale_color_viridis_d(option = "plasma") +
 labs(x = NULL, y = "Avg. # of trackers", title = "Change in avg. # of trackers on The Guardian & Le Figaro", subtitle = "12-month period") +
 ylim(0, 30) +
 theme_minimal()+
 theme(legend.position = c(0.5,0.85), 
       plot.title = element_text(hjust = 0.5), 
       plot.subtitle = element_text(hjust = 0.5),
       #axis.text.x=element_blank(),
       #axis.ticks.x=element_blank(),
       legend.title = element_blank(),
       #panel.border = element_blank(),
       panel.grid.major = element_blank(),
       panel.grid.minor = element_blank(),
       axis.line = element_line(colour = "black"))
```
</center>


# Session Info

```{r}
sessionInfo()
```

